<dataConfig>
<dataSource type="JdbcDataSource"
            driver="com.mysql.jdbc.Driver"
            url="jdbc:mysql://148.251.122.164/kbharkiv"
            user="kbharkiv"
            password="***REMOVED***"
            batchSize="-1"
             />
<document name="apacs_stats">
  <entity name="image_requests"
    pk="id"
    query=
    "
        SELECT stats.id, collection, file, loadTime, time, fileId, apacs_pages.page_number, apacs_units.description, 'image_requests' as statType,

        CASE
            WHEN apacs_units.description is null THEN collection
            ELSE CONCAT(collection, ' ', apacs_units.description)
        END as unit_description

        FROM stats
        left join apacs_pages ON apacs_pages.id = stats.fileId
        left join apacs_units on apacs_pages.unit_id = apacs_units.id
        left join apacs_collections ON apacs_collections.id = apacs_units.collections_id

        WHERE

        '${dataimporter.request.clean}' != 'false'

        OR

        time &gt; DATE_ADD('${dataimporter.last_index_time}',INTERVAL 2 HOUR)
    "
    preImportDeleteQuery="statType:image_requests"
    onError="skip"
    >
     <field column="id" name="id"/>
     <field column="collection" name="collection"/>
     <field column="file" name="file"/>
     <field column="loadTime" name="loadTime"/>
     <field column="time" name="time"/>
     <field column="fileId" name="fileId"/>
     <field column="statType" name="statType"/>
  </entity>
<entity name="system_exceptions"
    pk="id"
    query=
    "
        SELECT id, type, time, details, 'system_exceptions' as statType

        FROM apacs_exceptions

        WHERE

        '${dataimporter.request.clean}' != 'false'

        OR

        time &gt; DATE_ADD('${dataimporter.last_index_time}',INTERVAL 2 HOUR)
    "
    preImportDeleteQuery="statType:system_exceptions"
    onError="skip"
    >
     <field column="id" name="id"/>
     <field column="type" name="type"/>
     <field column="details" name="details"/>
     <field column="time" name="time"/>
     <field column="statType" name="statType"/>
  </entity>
</document>
</dataConfig>
