language: php

php:
  - 7.1

notifications:
  email: false

services:
  - docker

#stop travis mysql
before_install:
  - sudo service mysql stop

# setup infrastructure using docker-compose
install:
  - docker-compose -f docker-compose-webserver.deploy.yml up -d --force-recreate
  - sleep 120

# run tests inside Phalcon container
script:
  - docker-compose -f docker-compose-webserver.deploy.yml exec phalcon /code/vendor/bin/phpunit

# if on branch task2 deploy via ftp
after_success:
  script: docker-compose -f docker-compose-webserver.deploy.yml exec phalcon php /code/deployment/deploy.php
